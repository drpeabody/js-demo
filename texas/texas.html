<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>TEXAS - Text Based Strategy</title>
</head>
<style type="text/css">
	body{
		text-align: center;
		background: #111;
		color: #8a6;
	}
	.right-panel {
		position: absolute;
		left: 62vw;
		width: 33vw;
		height: 60vh;
	}
	.info-panel {
		position: absolute;
		left: 2vw;
		width: 55.5vw;
		height: 60vh;
	}
	.bottom-panel {
		position: absolute;
		left: 2vw;
		bottom: 2vh;
		width: 93vw;
		height: 8vh;
	}
	.cmd {
		width: 70%;
	}
	ul {
		text-align: left;
	}
	fieldset {
		overflow-y: scroll;
	}
	span {
		color: white;
	}
</style>
<body>

	<h1>TEXAS</h1>
	<h2>A Text Based Strategy Game.</h2>

	<fieldset class="right-panel">
		<legend>Logs</legend>
		<ul id="logger">
			
		</ul>
	</fieldset>

	<fieldset class="bottom-panel">
		<legend>Command</legend>
		Type in Your Command: <input type="text" class="cmd">
	</fieldset>

	<fieldset class="info-panel">
		<legend>Here is Your Status</legend>
		<ul>
			<li> Health: <span id="healthmeter"></span> </li>
			<li> Stamina: <span id="staminameter"></span> </li>
			<li> Location: <span id="locationmeter"></span></li>
			<li> Inventory: 
				<span><ul id="list-invent"></ul></span>
			</li>
		</ul>
	</fieldset>

</body>

<script type="text/javascript"> 
	// These are some utility functions to make life easier
	// The game doesn't depend upon them
	var $ = (name, idx) => {
		if(!name || name === '') return document;
		else if(name.startsWith('.')) {
			var docs = document.getElementsByClassName(name.substring(1));
			if(isNaN(idx)) return docs;
			else return docs[idx];
		}
		else if(name.startsWith('#')) {
			return document.getElementById(name.substring(1));
		}
	}
	var clog = console.log;
	var log = (val) => {
		var li = $().createElement('li');
		li.innerHTML = val;
		$("#logger").appendChild(li);
	}

	var toTitleCase = function (str) {
        return str.replace(
            /\w\S*/g,
            function(txt) {
                return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
            }
        );
    }
</script>

<script type="text/javascript">
	// These are core game functions, please understand how they work before you change
	var execute = (comm) => {
		var idxFirstSpace = comm.indexOf(" ");
		var cmd = comm.substring(0, idxFirstSpace);
		var args = comm.substring(idxFirstSpace + 1);
		if(idxFirstSpace === -1){
			cmd = comm;
			args = '';
		}
		if(!commands[cmd]) log('\''+ cmd + '\' is not a valid command right now.');
		else commands[cmd](args);
	}

	$().addEventListener('keypress', (e) => {
		if(e.code === 'Enter'){
			var cmd = $('.cmd', 0).value;
			$('.cmd', 0).value = '';
			execute(cmd.trim());
		}
	});
</script>

<script type="text/javascript">
	// This is the game, you would want to change these 
	// To customise the game or to add more features to it.
	const status = {
		health: 100,
		stamina: 100,
		location: 'living-room',
		inventory: []
	}

	const commands = {
		'help': () => {
			log(Object.keys(commands));
		},
		'clear': () => {
			var v = $('#logger');
			while(v.firstChild) v.removeChild(v.firstChild);
		},
		'goto': (loc) => {
			var l = status.location;
			if(!loc || loc === ''){
				log('You can Goto ' + map[l].adj.toString() + ' from ' + l);
			}
			else if(map[l].adj.includes(loc)){
				status.location = loc;
				$('#locationmeter').innerHTML = toTitleCase(status.location);
				log('You walked into the ' + loc);
			} else {
				log('Cannot goto ' + loc + ' from ' + l);
			}
		},
		'look': () => {
			var l = status.location;
			var itemsFound = map[l].items.filter(s => s.isVisible());
			if(itemsFound.length < 1) log('You can\'t see anything significant.');
			else log('You see:' + (itemsFound.map((s) => '<br>'+s.name())));
		},
		'pickup': (item) => {
			var l = status.location;
			var itemsFound = map[l].items
				.filter(s => s.name() === item)
				.filter(s => s.isPickable());
			if(itemsFound.length < 1) log('You picked up nothing. To pick up something\
				 yo must type in its name exactly, use single quotes as well.');
			else {
				itemsFound.forEach(s => {
					log('You picked up: ' + s.name());
					map[l].items = map[l].items.filter(x => x !== s);
					var li = $().createElement('li');
					li.innerHTML = s.name();
					$("#list-invent").appendChild(li);
					status.inventory.push(s);
				});
			}
		},
		'use': (item) => {
			log('Todo');
		}
	}

	class Item {
		// This is the super class of all objects in the game.
		// Some objects are invisible, such as items which require you to search
		// Some objects can be used
		// All objects must present a manual fir directions of use
		// All items have a name that is always enclosed in single quotes

		constructor(look, pick) {
			this.visible = look;
			this.pickable = pick;
		}

		isVisible() { return this.visible; }
		isPickable() { return this.pickable; }
		manual() { return 'Base class, should not be used directly.'; }
		name() { return '\'Base Item\''; }

	}

	class Key extends Item {
		constructor() { 
  			super(true, true);
		}
		manual() { return 'This is a key, You can use this key with the use command. It\
			 unlocks a door when used in the correct room.'; }
		name() { return '\'Key to the Front Door\''; }
	}


	const map = {	
		'living-room': {
			adj: ['kitchen', 'staircase'], //Adjacency List
			items: [ new Key(), new Key(), new Item(true, true) ]
		},
		'staircase': {
			adj: ['bedroom', 'living-room'], //Adjacency List
			items: [ ]

		},
		'bedroom': {
			adj: ['staircase', 'bathroom', 'balcony'], //Adjacency List
			items: [ ]

		},
		'kitchen': {
			adj: ['living-room'], //Adjacency List
			items: [ ]

		},
		'bathroom': {
			adj: ['bedroom'], //Adjacency List
			items: [ ]

		},
		'balcony': {
			adj: ['bedroom'], //Adjacency List
			items: [ ]

		},
	}


</script>
<script type="text/javascript">
	
	// This is where it all begins, the place that sets the game rolling

	setTimeout(() => {
		log('Welcome to Texas, A Text Based Strategy Game.');
		setTimeout(() => {
			log('Type \'help\' to list the commands you can use right now,');
			setTimeout(() => log('Follow your inventory in the status panel on the right, Good Luck!'), 2000);
		}, 1500);
	}, 500);

	$('#locationmeter').innerHTML = toTitleCase(status.location);
	$('#staminameter').innerHTML = '100%';
	$('#healthmeter').innerHTML = '100%';

</script>
</html>